backstage:
  backstage:
    appConfig:
      app:
      # Should be the same as backend.baseUrl when using the `app-backend` plugin.
      baseUrl: https://backstage.nwallace.io

      backend:
        # Note that the baseUrl should be the URL that the browser and other clients
        # should use when communicating with the backend, i.e. it needs to be
        # reachable not just from within the backend host, but from all of your
        # callers. When its value is "http://localhost:7007", it's strictly private
        # and can't be reached by others.
        baseUrl: https://backstage.nwallace.io
        # The listener can also be expressed as a single <host>:<port> string. In this case we bind to
        # all interfaces, the most permissive setting. The right value depends on your specific deployment.
        listen:
          port: 7007
        plugin:
          auth:
            connection:
              database: backstage
        # config options: https://node-postgres.com/apis/client
        database:
          client: pg
          pluginDivisionMode: schema
          connection:
            host: ${POSTGRES_HOST}
            port: ${POSTGRES_PORT}
            user: ${POSTGRES_USER}
            password: ${POSTGRES_PASSWORD}
            # https://node-postgres.com/features/ssl
            # you can set the sslmode configuration option via the `PGSSLMODE` environment variable
            # see https://www.postgresql.org/docs/current/libpq-ssl.html Table 33.1. SSL Mode Descriptions (e.g. require)
            # ssl:
            #   ca: # if you have a CA file and want to verify it you can uncomment this section
            #     $file: <file-path>/ca/server.crt
      auth:
        providers:
          guest: {}
      catalog:
        # Overrides the default list locations from app-config.yaml as these contain example data.
        # See https://backstage.io/docs/features/software-catalog/#adding-components-to-the-catalog for more details
        # on how to get entities into the catalog.
        locations:
          # Local example data, replace this with your production config, these are intended for demo use only.
          # File locations are relative to the backend process, typically in a deployed context, such as in a Docker container, this will be the root
          - type: file
            target: ./examples/entities.yaml
          # Local example template
          - type: file
            target: ./examples/template/template.yaml
            rules:
              - allow: [Template]
          # Local example organizational data
          - type: file
            target: ./examples/org.yaml
            rules:
              - allow: [User, Group]
    extraEnvVars:
      - name: POSTGRES_HOST
        value: backstage-rw
      - name: POSTGRES_PORT
        value: "5432"
      - name: APP_CONFIG_app_baseUrl
        value: https://backstage.nwallace.io
      - name: POSTGRES_USER
        valueFrom:
          secretKeyRef:
            name: backstage-postgresql-password
            key: username
      - name: POSTGRES_PASSWORD
        valueFrom:
          secretKeyRef:
            name: backstage-postgresql-password
            key: password
  ingress:
    enabled: true
    className: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/ssl-redirect: 'true'
    host: backstage.nwallace.io
    tls:
      enabled: true
      secretName: backstage.nwallace.io-tls-secret